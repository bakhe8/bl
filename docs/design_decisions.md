# Design Decisions v1.0 (Final Pre-Code)

## سياسة إضافة مورد جديد (Supplier Creation)
- المورد الجديد لا يُضاف تلقائياً، بل في حالتين: (1) إدخال يدوي من المستخدم، أو (2) وجوده ضمن خطاب سبق اعتماده.
- أي مورد غير مألوف من Excel يُعرض للمستخدم لاتخاذ القرار.

## سياسة التعلم ومنع التعلّم الخاطئ (Learning Safety)
- أي variant جديد (مورد) يرتبط بصف Excel سليم 100% ويُعتمد تلقائياً فور حفظ القرار، ويُعمَّم على الصفوف المماثلة. يمكن ترقية/دمج التعلم يدوياً في القواميس المرفقة لاحقاً.
- إذا كان variant مشابهًا لاسم رسمي بنسبة > 90% يجب إظهار تحذير للمستخدم.
- البنوك: لا تُنشأ بنوك جديدة، لكن يمكن تعلّم aliases مربوطة بأسماء رسمية ثابتة (لا تغيير على `banks.json`).

## سياسة مراجعة البيانات (Review Workflow)
- لا توجد شاشة مراجعة إضافية قبل الطباعة؛ المستخدم مسؤول عن المراجعة عند فتح الخطاب للطباعة.

## سياسة تنسيق المبلغ (Amount Formatting)
- لا تحويل للمبالغ إلى نص، المخرج رقمي بصيغة عربية-هندية مع فواصل: **٩٩٩٬٩٩٩٫٩٩ ريال**.

## سياسة أسماء البنوك الإنجليزية (Bank Name Matching)
- القاموس الرسمي للبنوك بالعربية فقط مع اختصارات/أسماء EN في الحقل `short[]` (مصدرها `banks.json`).
- التطابق تلقائي إذا كان الاسم أو الاختصار موجوداً في القاموس الرسمي، مع Fuzzy ≥ 0.9؛ إذا لم يوجد → رسالة “اسم البنك غير معروف – اختر من القائمة الرسمية”.
- لا تعلّم ولا تخزين محلي للبنوك، ولا تُضاف اختصارات جديدة من التطبيق.

## سياسة الترميز (Encoding)
- يقبل النظام ملفات UTF-8 فقط. أي ملف يظهر فيه "؟؟؟" يُرفض مباشرة مع رسالة:
  - "تعذّر قراءة الملف: صيغة الترميز غير معتمدة (UTF-8 فقط)."

## سياسة التاريخ (Date Handling)
- يدعم جميع صيغ التواريخ في الإدخال؛ المخرج دائماً بصيغة عربية موحدة: **01 يناير 2025م**.

## سياسة التراجع (Undo)
- لا يوجد زر تراجع؛ القرارات تُحفظ فوراً. عند تسجيل variant جديد يُعرض تحذير.

## سياسة فقدان بيانات LocalStorage
- LocalStorage يُستخدم لتعلم الموردين (`bgl_supplier_variants`) وaliases للبنوك، دون تعديل القواميس الرسمية. هذا مقصود للحفاظ على مصدر الحقيقة.
- لا يوجد Auto-Backup أو استرداد تلقائي من الواجهة حالياً، والتعلم مخصص للجلسة/المتصفح الحالي. يمكن تصدير/استيراد التعلم يدوياً من الـ Console عبر `window.learningTools` عند الحاجة.

## سياسة لغة البيانات داخل Excel
- النظام يتعامل مع خليط عربي/إنجليزي في الإدخال، لكن المخرجات النهائية دائماً بالعربية. الـ Matching يتعامل مع EN→AR بحذر دون استنتاجات غير موثوقة.
