# وثيقة خوارزميات التطابق — أولوية 4/5

## طبقات التطابق
1) البنوك: تطابق مباشر/اختصار فقط ضد القاموس الرسمي (`banks.json`)، مع Fuzzy ≥ 0.9 للتقارب العالي. لا variants ولا تعلم.
2) الموردون: تطابق رسمي، ثم variants (LocalStorage + بذرة `variants_suppliers.json`)، ثم Fuzzy:
   - ≥ 0.90 اعتماد تلقائي.
   - 0.80–0.89 اقتراح للمستخدم في واجهة القرارات.
   - < 0.80 يعتبر اسمًا جديدًا ويُعرض للقرار.

## إدارة الغموض
- البنوك غير المعروفة: رسالة تنبيه “اسم البنك غير معروف – اختر من القائمة الرسمية”.
- الموردون غير المحسومين: عرض في واجهة القرارات مع اقتراح Fuzzy إن وجد.
- عند تعدد تطابقات متقاربة: عرض مرتّب بالثقة؛ لا قبول تلقائي تحت 0.80.

## حفظ القرار
- البنوك: لا حفظ ولا تعلّم.
- الموردون: قرار المستخدم يحفظ variant في LocalStorage (`bgl_supplier_variants`) ويُبنى من بذرة `variants_suppliers.json` عند أول تشغيل.
- ترقية variant: occurrences ≥ 3 → confirmed = true → لا يظهر مجددًا في قائمة القرارات.

## شكل تخزين variant (مثال)
```json
{
  "raw": "rajhi bank",
  "officialId": "bank_001",
  "language": "en",
  "count": 1,
  "confirmed": false
}
```

## جودة التطابق
- حد أدنى للتشابه قبل اعتماد Fuzzy.
- استخدام سياق إضافي (مبلغ/تاريخ/رقم ضمان) للمساعدة في القرار اليدوي عند اللزوم.
