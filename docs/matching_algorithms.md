# وثيقة خوارزميات التطابق — أولوية 4/5

## طبقات التطابق
1) تطابق مباشر مع القواميس الرسمية (عربي/إنجليزي) بعد التطبيع.
2) تطابق باستخدام الـ variants (أخطاء شائعة، اختصارات، لغات مختلفة).
3) ترشيح بسيط أو Fuzzy محدود عند تباين بسيط:
   - Levenshtein أساساً (مقبول إذا المسافة ≤ 2 أو التشابه ≥ 0.85).
   - Jaro Winkler كتحقق إضافي عند الحاجة.

## إدارة الغموض
- الصفوف غير المحسومة تُعرض في شاشة القرارات.
- عرض خيارات مقترحة للمستخدم مع اعتماد قراره كـ variant جديد (مع تحذير عند إنشاء variant لأول مرة).
- لا تغيير تلقائي عند ثقة < 0.85؛ بين 0.7 و0.85 يعرض للمستخدم، وأقل من 0.7 مرفوض تلقائياً.
- أسماء البنوك الإنجليزية لا تُطابق تلقائياً؛ تُعرض للمستخدم لاختيار البنك العربي الرسمي.
- عند تعدد تطابقات محتملة بدرجات متقاربة، اعرضها مرتبة بالثقة ودعم بحث سريع.

## حفظ القرار
- كل قرار (variant → official) يُحفظ في LocalStorage ويُصدَّر/يُستورد عبر JSON.
- variant يُعتبر غير مؤكد حتى يظهر في 3 ملفات Excel مختلفة؛ بعدها يصبح مؤكداً ويمكن ترقيته.
- احتفظ باللغة/المصدر لتحاشي تصادم الأسماء المتشابهة.
- دمج الـ variants المتقاربة (بعد التطبيع) بشكل دوري؛ عند التصدير دمج أي زوج تشابهه > 0.9 (فرق < 10%) لتقليل التضخم.

## جودة التطابق
- حد أدنى للتشابه قبل اعتماد Fuzzy.
- استخدام سياق إضافي (مبلغ/تاريخ/رقم ضمان) للمساعدة في القرار اليدوي عند اللزوم.
