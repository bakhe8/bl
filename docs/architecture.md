# المعمارية

## نظرة عامة
تطبيق ويب محلي (Client-only) من صفحة HTML واحدة تعتمد على JavaScript وSheetJS لقراءة Excel، مع حفظ القواميس في LocalStorage. لا توجد خوادم أو قواعد بيانات خارجية.

## المكونات الرئيسية
- **واجهة المستخدم (UI)**: استقبال ملف Excel، عرض السطور الغامضة (الموردون فقط)، واستعراض الخطاب النهائي.
- **محول Excel → JSON**: SheetJS لتحويل الملف إلى هيكل JSON موحّد.
- **معالج البيانات**: تنظيف الحقول (أسماء، مبالغ، تواريخ) وتنسيقها.
- **قاموس البنوك الرسمي**: قراءة فقط من `src/data/dictionaries/banks.json` (لا تعلّم/لا تخزين محلي).
- **قاموس الموردين المتعلّم**: موردون رسميون + variants متعلمة في LocalStorage (بذرة من `variants_suppliers.json`).
- **مولّد الخطاب**: تطبيق قالب عربي RTL وتجهيزه للطباعة عبر المتصفح.

## تدفق البيانات
1) المستخدم يرفع ملف Excel.
2) SheetJS يحوله إلى JSON داخلي.
3) المعالج ينظف القيم ويوحد أسماء البنوك والموردين بالاستعانة بالقاموس.
4) يتم عرض السطور غير المحسومة للمستخدم لاختيار الصيغة الصحيحة وتحديث القاموس.
5) بعد التأكيد، يُولّد الخطاب بتنسيق ثابت وجاهز للطباعة/التصدير PDF من المتصفح.

## التخزين
- **البنوك**: JSON رسمي فقط (قراءة).
- **الموردون**: LocalStorage لـ variants (`bgl_supplier_variants`) + بذرة JSON، لا تعديل تلقائي للقواميس الرسمية؛ التعلّم محلي للجلسة/المتصفح ويمكن تصديره/استيراده يدوياً من Console.

## التقنيات
- HTML/CSS مع دعم RTL كامل.
- JavaScript لتشغيل المنطق وتحليل البيانات وإدارة القاموس وبناء الخطاب.
- SheetJS لقراءة Excel دون تبعيات ثقيلة.
- متصفح حديث (Chrome/Edge) للتشغيل والطباعة إلى PDF.

## اعتبارات الجودة
- استخدام قالب خطاب موحد لضمان الاتساق.
- عرض حالات الغموض فقط لتسريع القرار وتقليل الأخطاء.
- تصميم خفيف بلا خادم يعزز الاستقرار وسهولة الصيانة.

## نقاط التعقيم (Sanitize Pipeline)
- بعد القراءة والتطبيع: تعقيم القيم قبل التخزين المؤقت.
- قبل عرض جدول القرارات: ترميز/تعقيم النصوص الخام.
- قبل الحقن في قالب HTML للطباعة: تعقيم placeholders لضمان خلوّها من HTML.
