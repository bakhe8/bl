# المعمارية

## نظرة عامة
تطبيق ويب محلي (Client-only) من صفحة HTML واحدة تعتمد على JavaScript وSheetJS لقراءة Excel، مع حفظ القواميس في LocalStorage. لا توجد خوادم أو قواعد بيانات خارجية.

## المكونات الرئيسية
- **واجهة المستخدم (UI)**: استقبال ملف Excel، عرض السطور الغامضة، واستعراض الخطاب النهائي قبل الطباعة.
- **محول Excel → JSON**: استخدام SheetJS لتحويل الملف إلى هيكل JSON داخلي موحّد.
- **معالج البيانات**: تنظيف الحقول (أسماء، مبالغ، تواريخ) وتنسيقها.
- **قاموس التعلّم**: تخزين وربط أسماء البنوك والموردين بصيغهم الرسمية، مع تحديث مستمر بناءً على قرارات المستخدم (LocalStorage + ملفات JSON للتصدير/الاستيراد).
- **مولّد الخطاب**: تطبيق قالب خطاب رسمي بالعربية (RTL) وتجهيزه للطباعة عبر المتصفح.

## تدفق البيانات
1) المستخدم يرفع ملف Excel.
2) SheetJS يحوله إلى JSON داخلي.
3) المعالج ينظف القيم ويوحد أسماء البنوك والموردين بالاستعانة بالقاموس.
4) يتم عرض السطور غير المحسومة للمستخدم لاختيار الصيغة الصحيحة وتحديث القاموس.
5) بعد التأكيد، يُولّد الخطاب بتنسيق ثابت وجاهز للطباعة/التصدير PDF من المتصفح.

## التخزين
- **LocalStorage**: المصدر الأساسي للقاموس المتعلم.
- **JSON للتبادل**: تصدير/استيراد القاموس أو تكوينات أخرى لحفظ نسخة احتياطية أو مشاركتها.

## التقنيات
- HTML/CSS مع دعم RTL كامل.
- JavaScript لتشغيل المنطق وتحليل البيانات وإدارة القاموس وبناء الخطاب.
- SheetJS لقراءة Excel دون تبعيات ثقيلة.
- متصفح حديث (Chrome/Edge) للتشغيل والطباعة إلى PDF.

## اعتبارات الجودة
- استخدام قالب خطاب موحد لضمان الاتساق.
- عرض حالات الغموض فقط لتسريع القرار وتقليل الأخطاء.
- تصميم خفيف بلا خادم يعزز الاستقرار وسهولة الصيانة.

## نقاط التعقيم (Sanitize Pipeline)
- عند قراءة البيانات من Excel: تطبيع/تعقيم القيم الخام قبل التخزين.
- عند عرض البيانات في جدول القرارات: ترميز/تعقيم النصوص قبل حقنها في DOM.
- عند حقن البيانات في قالب HTML للطباعة: تعقيم placeholders قبل التوليد لضمان عدم تمرير رموز HTML.
