# وثيقة القواميس — أولوية 5/5

القواميس هي “العقل” الذي يضمن تطابق أسماء البنوك والموردين بدقة ثابتة.

## أنواع القواميس
- **القواميس الرسمية** (`banks_official`, `suppliers_official`): صيغ عربية رسمية فقط للبنوك (كما تنشرها الجهة الرسمية مثل SAMA، بدون تشكيل/اختصارات). الموردون: الاسم التجاري العربي الرسمي كما يظهر في العقد/الفاتورة، بدون تطويل أو اختصارات.
- **القواميس التعلمية (variants)** (`banks_variants`, `suppliers_variants`): تحفظ الأخطاء الشائعة، الاختصارات، والأسماء البديلة التي أكدها المستخدم. لا تُضاف اختصارات انجليزية للبنوك تلقائياً.

## قواعد التطبيع (Normalization)
- الإنجليزية: تحويل إلى lowercase، إزالة الفراغات الزائدة (أول/آخر، وتكرار داخلي)، استبدال تكرار المسافات بمسافة واحدة، إزالة النقاط/الرموز الشائعة (. , - _ /) إذا لم تكن وسط أرقام، إبقاء كلمات مثل bank/company/co/intl.
- العربية: إزالة الفراغات الزائدة، توحيد الرموز مثل "ـ" وغيرها، عدم إزالة كلمات مثل شركة/بنك/مصرف/مؤسسة، إبقاء التشكيل إن وجد، تطبيع الهمزات قدر الإمكان للمقارنة فقط.
- لا ترجمة ولا استنتاج معنى جديد؛ التنظيف لتوحيد الشكل لا المعنى.
- منع تكرار الأسماء الرسمية بفروق طفيفة (فراغ/همزة) عبر التطبيع قبل الإضافة.

## التخزين
- LocalStorage هو المصدر التشغيلي.
- JSON للتصدير/الاستيراد (نسخة احتياطية أو مشاركة بين أجهزة).
- احفظ رقم إصدار ملف القاموس (مثلاً `schemaVersion: 1.0.0` و`version: "1.0.0"` و`generated_at`) للتحقق عند الاستيراد.
- حد تشغيلي مقترح لـ LocalStorage: 4MB، مع تحذير عند 90%. عند التصدير دمج الـ variants المتقاربة لتقليل الحجم.
- سياسة الفقد: حذف بيانات المتصفح يعيد النظام للبداية؛ لا يوجد استرداد تلقائي.

## شكل بيانات مقترح (مثال)
```json
{
  "official": {
    "banks": [
      { "id": "bank_001", "ar": "مصرف الراجحي", "en": "Al Rajhi Bank" }
    ],
    "suppliers": [
      { "id": "sup_001", "ar": "شركة التوريد المتحدة", "en": "United Supply Co." }
    ]
  },
  "variants": [
    { "type": "bank", "variant": "rajhi bank", "officialId": "bank_001", "language": "en" },
    { "type": "supplier", "variant": "شركة توريد متحده", "officialId": "sup_001", "language": "ar" }
  ]
}
```

## آلية العمل
1) التطابق يبدأ بالقاموس الرسمي.
2) ثم ينتقل للـ variants (عربي/إنجليزي/اختصارات) بعد التطبيع. أسماء بنوك إنجليزية لا تؤدي لتطابق تلقائي؛ تُعرض للمستخدم ليختار البنك العربي الرسمي.
3) إذا فشل أو تعدد officialId محتمل، يُعرض للمستخدم اتخاذ القرار ولا يُحفظ variant إلا بعد الموافقة.

## إضافة/تحديث بنك أو مورد
- أضف الاسم الرسمي والمعرف.
- اربط الـ variants المعروفة بالمعرف الرسمي.
- المورد الجديد لا يُضاف تلقائياً إلا يدوياً أو عند تأكيده ضمن خطاب معتمد سابقاً.
- كل قرار جديد يُسجَّل ويعاد استخدامه تلقائياً بعد مروره على الضوابط أدناه.

## ترقية/تأكيد variant
- إذا تكرر الاستخدام في 3 ملفات Excel مختلفة واعتمد، يُعتبر مؤكداً ويمكن ترقيته إلى القاموس الرسمي.
- variant جديد يُحفظ بتحذير، ويُعتبر غير مؤكد حتى استيفاء الشرط أعلاه.

## مبادئ
- لا تُحذف الـ variants إلا إذا ثبت خطؤها.
- احتفظ باللغة/المصدر لتسهيل البحث والتطابق.
- عند تعارض أكثر من officialId محتمل، لا تعتمد اختياراً تلقائياً؛ اعرض الخيارات وسجّل قرار المستخدم مع سبب مختصر في القاموس (تعليق/ملاحظة).
- عند التصدير يمكن دمج variants المتقاربة (فرق تشابه < 10%) لتقليل الحجم قبل الحفظ الخارجي.
- إذا كان variant مشابهًا لاسم رسمي بنسبة > 90% أظهر تحذيراً قبل الحفظ.
