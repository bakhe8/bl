# وثيقة القواميس — أولوية 5/5

القواميس هي “العقل” الذي يضمن تطابق أسماء البنوك والموردين بدقة ثابتة.

## أنواع القواميس
- **القواميس الرسمية** (JSON ثابت):
  - البنوك: `src/data/dictionaries/banks.json` — ثابتة 100%، تحوي `official` (عربي) و`short[]` للاختصارات EN، ولا يتم تعلم بنك جديد مطلقًا.
  - الموردون: `src/data/dictionaries/suppliers.json` — الأسماء العربية الرسمية فقط.
- **القواميس التعلمية للموردين**:
  - بذرة تعلم: `src/data/dictionaries/variants_suppliers.json` (تُحمّل للذاكرة عند البدء).
  - التخزين التشغيلي: LocalStorage تحت المفتاح `bgl_supplier_variants`.
  - لا يوجد تعلّم للبنوك ولا أي تخزين محلي لها.

## قواعد التطبيع (Normalization)
- الإنجليزية: إلى lowercase، دمج المسافات، إزالة النقاط/الرموز البسيطة، إبقاء الكلمات الدلالية (bank/co/...).
- العربية: دمج المسافات، توحيد الهمزات/الياء/التاء المربوطة، إزالة التشكيل فقط لأغراض المطابقة.
- لا ترجمة ولا حذف كلمات؛ التنظيف لتوحيد الشكل دون تغيير المعنى.

## التخزين
- البنوك: قراءة فقط من `banks.json` (لا حفظ محلي).
- الموردون: قراءة من `suppliers.json` + تحميل بذرة `variants_suppliers.json` إلى LocalStorage (`bgl_supplier_variants`).
- حد تشغيلي مقترح لـ LocalStorage: 4MB؛ تحذير عند 3.6MB.
- نسخة احتياطية: يمكن تصدير LocalStorage ودمجها مع ملفات JSON عند الحاجة (يدوياً).

## شكل بيانات (مستخدم حالياً)
- `banks.json`:
```json
{ "version":1,"banks":[{"id":"bank_001","official":"البنك العربي الوطني","short":["ANB","ARAB NATIONAL BANK"]}] }
```

- `suppliers.json`:
```json
{ "version":1,"suppliers":[{"id":"sup_001","official":"شركة كير للتطوير"}] }
```

- `variants_suppliers.json` (بذرة):
```json
{ "records":[{"raw":"CURE DEV","clean":"cure dev","officialId":"sup_001","occurrences":3,"confirmed":true}] }
```

## آلية العمل
1) البنوك: تطابق مباشر/اختصار فقط ضد القاموس الرسمي → لا تعلّم ولا حفظ.
2) الموردون: تطابق رسمي، ثم variants من LocalStorage/البذرة، ثم Fuzzy:
   - ≥0.9 اعتماد تلقائي، 0.8–0.89 اقتراح، <0.8 قرار يدوي.
3) إضافة variant: بعد موافقة المستخدم فقط؛ يترقى إلى مؤكد عند ≥3 تكرارات.

## إضافة/تحديث
- البنوك: تعديل `banks.json` يدوياً فقط.
- الموردون: إضافة رسمية عبر `suppliers.json`، أو تعلم variant بعد موافقة المستخدم. ترقية variant تلقائية عند ≥3 تكرارات.

## مبادئ
- لا حذف إلا للمتأكد أنه خطأ.
- احتفظ باللغة/المصدر.
- عند تعارض، لا اعتماد تلقائي؛ اعرض القرار للمستخدم وسجّل اختياره.
